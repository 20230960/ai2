<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>实验选择入口（start1）</title>
  <style>
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans SC",sans-serif;
      margin:0;background:#f3f4f6;color:#111827;
    }
    .wrap{max-width:980px;margin:18px auto;padding:0 14px;}
    .card{
      background:#fff;border-radius:12px;padding:14px 16px;
      box-shadow:0 6px 16px rgba(15,23,42,.06);
    }
    h1{font-size:20px;margin:0 0 6px 0;}
    .sub{font-size:13px;color:#6b7280;line-height:1.5;margin:0 0 12px 0;}
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;}
    @media (max-width:720px){.grid{grid-template-columns:1fr;}}
    .exp{
      border:1px solid #e5e7eb;border-radius:12px;background:#fff;
      padding:12px 12px;cursor:pointer;transition:.12s ease;
    }
    .exp:hover{transform:translateY(-1px);box-shadow:0 10px 20px rgba(15,23,42,.08);}
    .exp-title{font-weight:700;margin:0 0 6px 0;}
    .exp-desc{font-size:12.5px;color:#6b7280;line-height:1.4;margin:0;}
    .btnrow{display:flex;justify-content:space-between;gap:10px;margin-top:12px;align-items:center;}
    .btn{
      border:none;border-radius:10px;padding:10px 14px;font-size:13px;font-weight:700;
      background:#111827;color:#fff;cursor:pointer;
    }
    .btn2{
      border:1px solid #e5e7eb;background:#fff;color:#111827;
    }
    .status{
      font-size:12px;color:#6b7280;
    }
    code{background:#f3f4f6;padding:2px 6px;border-radius:6px;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>请选择要参与的实验</h1>
      <p class="sub">
        点击下方任意一个实验入口进入对应页面。进入后请按提示完成任务并继续填写问卷。
        （如需重新选择，可点击“清除并重新选择”。）
      </p>

      <div class="grid">
        <!-- 实验1 -->
        <div class="exp" data-id="EXP1" data-url="cond_interactive_promo.html">
          <p class="exp-title">实验 1</p>
          <p class="exp-desc">交互 + 促销倒计时（必须互动一次才能继续）</p>
          <p class="exp-desc">页面文件：<code>cond_interactive_promo.html</code></p>
        </div>

        <!-- 实验2 -->
        <div class="exp" data-id="EXP2" data-url="cond_interactive_nopromo.html">
          <p class="exp-title">实验 2</p>
          <p class="exp-desc">交互 + 非促销（必须互动一次才能继续）</p>
          <p class="exp-desc">页面文件：<code>cond_interactive_nopromo.html</code></p>
        </div>

        <!-- 实验3 -->
        <div class="exp" data-id="EXP3" data-url="cond_static_promo.html">
          <p class="exp-title">实验 3</p>
          <p class="exp-desc">非交互 + 促销倒计时（固定中等摘要）</p>
          <p class="exp-desc">页面文件：<code>cond_static_promo.html</code></p>
        </div>

        <!-- 实验4 -->
        <div class="exp" data-id="EXP4" data-url="cond_static_nopromo.html">
          <p class="exp-title">实验 4</p>
          <p class="exp-desc">非交互 + 非促销（固定中等摘要）</p>
          <p class="exp-desc">页面文件：<code>cond_static_nopromo.html</code></p>
        </div>
      </div>

      <div class="btnrow">
        <button class="btn btn2" id="resetBtn">清除并重新选择</button>
        <div class="status" id="statusText"></div>
      </div>
    </div>
  </div>

<script>
  function genPid() {
    return "P" + Date.now().toString(36) + Math.random().toString(36).slice(2,7).toUpperCase();
  }

  function updateStatus() {
    const pid = sessionStorage.getItem("participant_id");
    const cond = sessionStorage.getItem("exp_condition");
    const url  = sessionStorage.getItem("exp_condition_url");
    const el = document.getElementById("statusText");
    if (pid && cond && url) {
      el.innerHTML = `当前记录：PID=<code>${pid}</code>，选择=<code>${cond}</code>，页面=<code>${url}</code>`;
    } else {
      el.textContent = "尚未选择实验。";
    }
  }

  function selectExperiment(expId, url) {
    // 生成/保留 PID
    const existingPid = sessionStorage.getItem("participant_id") || genPid();
    sessionStorage.setItem("participant_id", existingPid);

    // 记录被试选择的“实验条件”
    sessionStorage.setItem("exp_condition", expId);
    sessionStorage.setItem("exp_condition_url", url);

    // 记录时间戳 & 清空本次会话的数据容器
    sessionStorage.setItem("task_start_ts", new Date().toISOString());
    sessionStorage.setItem("interactionLog", JSON.stringify([]));
    sessionStorage.setItem("final_state", JSON.stringify({}));

    // 跳转到被试选择的实验页面
    window.location.href = url;
  }

  // 点击卡片进行选择
  document.querySelectorAll(".exp").forEach(el => {
    el.addEventListener("click", () => {
      const expId = el.getAttribute("data-id");
      const url = el.getAttribute("data-url");
      selectExperiment(expId, url);
    });
  });

  // 清除并重新选择
  document.getElementById("resetBtn").addEventListener("click", () => {
    sessionStorage.clear();
    updateStatus();
    alert("已清除本次会话记录。现在可以重新选择实验。");
  });

  updateStatus();
</script>
</body>
</html>
